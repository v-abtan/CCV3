## Company Communicator v3.1 Migration Guide

## Upgrading from v3 to v3.1
If you have the CCv3 deployed and plan to migrate to CCv3.1, perform the following steps:

### 1. Read CCv3 deployment parameters:
Copy all the parameters from the previous deployment (CCv3), and make sure you have the following:
  * Name of the Azure subscription.
  * Name of the Azure resource group.
  * Base resource name.
  * Bot tenant ID.
  * Bot client ID.(Referred as User Client Id in CCv3.1)
  * Bot client secret.(Referred as User Client Secret in CCv3.1)
  * Sender UPN list.

We will use them in the next steps.

Please refer [step 2](https://github.com/OfficeDev/microsoft-teams-company-communicator-app/wiki/Deployment-guide) in the Deployment guide for more details about the above values.

### 2. Register Azure AD application.
1. Register an Azure AD application in your tenant's directory for author bot.

2. Log in to the Azure Portal for your subscription, and go to the [App registrations](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredApps) blade.

3. Click **New registration** to create an Azure AD application.
    - **Name**: Name of your Teams App - if you are following the template for a default deployment, we recommend "Company Communicator".
    - **Supported account types**: Select "Accounts in any organizational directory" (*refer image below*).
    - Leave the "Redirect URI" field blank for now.

    ![Azure AD app registration page](images/multitenant_app_creation.png)

4. Click **Register** to complete the registration.

5. When the app is registered, you'll be taken to the app's "Overview" page. Copy the **Application (client) ID**; we will need it later. Verify that the "Supported account types" is set to **Multiple organizations**.

    ![Azure AD app overview page](images/multitenant_app_overview_1.png)

6. On the side rail in the Manage section, navigate to the "Certificates & secrets" section. In the Client secrets section, click on "+ New client secret". Add a description for the secret, and choose when the secret will expire. Click "Add".

    ![Azure AD app secret](images/multitenant_app_secret.png)

7. Once the client secret is created, copy its **Value**; we will need it later.

### 3. Clean the user app registration

1. Under **Manage**, click on **Authentication** to bring up authentication settings.

    1. Copy and the delete the entry to **Redirect URIs**.Save the value.

    1. Click **Save** to commit your changes.

1. Back under **Manage**, click on **Expose an API**.

    1. Copy and Delete the **Application ID URI** and save the value.

    1. Click **Save** to commit your changes.

Please follow the steps from [step 2](https://github.com/OfficeDev/microsoft-teams-company-communicator-app/wiki/Deployment-guide) in the Deployment guide to complete the migration.
